{% extends 'base.html' %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pharmacy.css') }}">
{% endblock %}
{% block title %}My Cart{% endblock %}

{% block content %}
<div class="cart-container">
    <h1>Your Cart</h1>
    <div class="cart-items">
        {% if cart_items %}
            <table>
                <thead>
                    <tr>
                        <th>Medicine</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Total</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart_items %}
                    <tr>
                        <td>{{ item.medicine.name }}</td>
                        <td>${{ "%.2f"|format(item.medicine.price) }}</td>
                        <td>
                            <input type="number" value="{{ item.quantity }}" min="1" data-id="{{ item.medicine_id }}" class="quantity-input">
                        </td>
                        <td>${{ "%.2f"|format(item.medicine.price * item.quantity) }}</td>
                        <td>
                            <button class="remove-btn" data-id="{{ item.medicine_id }}">Remove</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Your cart is empty.</p>
        {% endif %}
    </div>
    <div class="cart-summary">
        <h3>Total: $<span id="cart-total">{{ cart_items | sum(attribute='medicine.price') }}</span></h3>
        <button class="checkout-btn">Proceed to Checkout</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.querySelectorAll('.quantity-input').forEach(input => {
        input.addEventListener('change', function() {
            const medicineId = this.getAttribute('data-id');
            const quantity = this.value;
            // Make an AJAX call to update the cart
            fetch(`/cart/update/${medicineId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ quantity: quantity })
            }).then(response => response.json()).then(data => {
                if (data.success) {
                    location.reload(); // Reload the page to see updated cart
                }
            });
        });
    });

    document.querySelectorAll('.remove-btn').forEach(button => {
        button.addEventListener('click', function() {
            const medicineId = this.getAttribute('data-id');
            fetch(`/cart/remove/${medicineId}`, {
                method: 'DELETE'
            }).then(response => response.json()).then(data => {
                if (data.success) {
                    location.reload(); // Reload the page to see updated cart
                }
            });
        });
    });
</script>
{% endblock %}